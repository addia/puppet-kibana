#  ______________________________________
# / NOTE: This file is managed by Puppet \
# \ - do not change it here, ever!       /
#  --------------------------------------
#         \   ^__^
#          \  (OO)\_______
#             (__)\       )\/\
#                 ||----w |
#                 ||     ||
#
# ----------------------------------------
#
#
# Nginx server block for Kibana
#
# config file:  /etc/nginx/conf.d/kibana.conf
#
#
server {
    listen 443;
    server_name <%= @kibana_server %>;

    ssl_certificate             <%= @server_key %>;
    ssl_certificate_key         <%= @server_cert %>;
    ssl_protocols               TLSv1 TLSv1.1 TLSv1.2;
    
    access_log                  /var/log/nginx/kibana-access.log  main;
    error_log                   /var/log/nginx/kibana-error.log;

    location / {
        proxy_pass http://localhost:5601;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;        
    }
}
